<html>
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/static/css/bootstrap.min.css" type="text/css"></link>
    <script src="/browserid/authentication_api.js"></script>
    <script type="text/javascript">

function toggleVisibility(id) {
    var e = document.getElementById(id);
    if(e.style.display == 'block') {
        e.style.display = 'none';
    } else {
        e.style.display = 'block';
    }
};

function userHasActiveSession(email) {
    if (email) {
        return true;
    };
    return false;
};

function authenticateEmailCancel() {
    console.log('User clicked cancel.');
};

function authenticateEmail() {
    console.log("Attempting to authenticate email address...");
    try {
        var email = document.getElementById('emailInput').value;
        var passwd = document.getElementById('passwordInput').value;
        
        console.log("Got email address: " + email);
        console.log("Got password: " + passwd);

        navigator.mozId.beginAuthentication(function(email) {
            if (userHasActiveSession(email)) {
                navigator.mozId.completeAuthentication();
            } else {
                var err = "Please enter a valid email address and try again.";
                alert(err);
                document.getElementById('alertWarnText').innerHTML = err;
            };
        });
        console.log("Finished beginAuthentication() callback.");

    } catch (e) {
        console.log(e + ": " + e.stack);
    };

    var sm = "Login successful!";
    document.getElementById('loginSuccess').innerHTML = sm;
};

function checkForNativePersonaAPI() {
    try {
        navigator.mozId.raiseAuthenticationFailure();
    } catch (e) {
        console.log("WARNING: Native Persona API is missing; no navigator.mozId.")
        document.getElementById('alertWarnText').innerHTML = "To use this
            Persona testing server, you must first navigate to about:config
            and set `dom.identity.enabled` to `true`.";
        return false;
    };
    console.log("Hooray! We have navigator.mozId!");
    return true;
};
checkForNativePersonaAPI();

    </script>
  </head>
  <body>

<div class="navbar navbar-inverse">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-inverse-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/index.html">Persona</a>
  </div>
  <div class="navbar-collapse collapse navbar-inverse-collapse">
    <ul class="nav navbar-nav">
      <li><a href="/browserid/provision.html">Provisioning</a></li>
      <li class="active"><a href="/browserid/signin.html">Sign In</a></li>
    </ul>
    <form class="navbar-form navbar-left">
      <input class="form-control col-lg-8" placeholder="Search" type="text">
    </form>
    <ul class="nav navbar-nav navbar-right">
      <li><a href="https://torproject.org">The Tor Project</a></li>
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <b class="caret"></b></a>
        <ul class="dropdown-menu">
          <li><a href="#">Action</a></li>
          <li><a href="#">Another action</a></li>
          <li><a href="#">Something else here</a></li>
          <li class="divider"></li>
          <li><a href="#">Separated link</a></li>
          <li><a href="#">One more separated link</a></li>
        </ul>
      </li>
    </ul>
  </div>
</div>

<div class="container-fluid"
     style="width: 100%; align: center; margin: auto;">

  <div class="bs-docs-section">
    <!-- Various dismissable alerts which are toggleable and hidden by default -->
    <div class="row" style="display: none;" id="loginSuccess">
      <div class="alert alert-dismissable alert-info" id="loginSuccessText">
        <button type="button" class="close" data-dismiss="alert"
		        onclick="toggleVisibility('loginSuccess')">×</button>
      </div>
    </div>

    <div class="row" style="display: none;" id="alertWarn">
      <div class="alert alert-dismissable alert-warn" id="alertWarnText">
        <button type="button" class="close" data-dismiss="alert"
		        onclick="toggleVisibility('alertWarn')">×</button>
      </div>
    </div>

    <!-- Left column with login choices -->
    <div class="row">
      <div class="col-lg-6">

	<br />
	<br />

	<div class="container-fluid" id="authentication-form"
	     style="align-content: left; align: left; width: 100%; text-align: center;">
	  <div class="container-fluid"
	       style="width: 96%; align: center; margin-left: 2%; margin-right: 2%;">
	    <div class="panel panel-primary">
	      <div class="panel-heading">
		<h3 class="panel-title">Email Login</h3>
	      </div>

	      <form class="form-horizontal" style="width: 90%; margin: auto;"
		        name="emailAuthForm">
		    <!-- action="/browserid/signin.html" method="get"> -->
		<fieldset>
		  <legend></legend>
		  <span class="help-block">Sign up for a Persona Identity using an email address!</span>
		  <div class="form-group">
		    <label for="emailInput" class="col-lg-2 control-label">Email</label>
		    <div class="col-lg-10">
		      <input class="form-control" id="emailInput" placeholder="Email" type="text">
		    </div>
		  </div>
		  <div class="form-group">
		    <label for="passwordInput" class="col-lg-2 control-label">Password</label>
		    <div class="col-lg-10">
		      <input class="form-control" id="passwordInput" placeholder="Password" type="password">
		      <div class="checkbox">
			<label>
			  <input type="checkbox"> Remember Me
			</label>
		      </div>
		    </div>
		  </div>
		  <!-- <div class="form-group">
		    <label for="textArea" class="col-lg-2 control-label">Message</label>
		    <div class="col-lg-10">
		      <textarea class="form-control" rows="2" id="textArea"></textarea>
		      <span class="help-block">Leave a message for the maintainers of this site. (optional)</span>
		    </div>
		  </div> -->
		  <div class="form-group">
		    <div class="col-lg-10 col-lg-offset-2">
		      <button class="btn btn-default" id="cancelButton"
			      onclick="authenticateEmailCancel()">Cancel</button>
		      <input type="button" class="btn btn-primary" id="submitButton" value="Submit"
			     onclick="authenticateEmail()" />
		    </div>
		  </div>
		</fieldset>
	      </form>

	    </div>
	  </div> <!-- end authentication-form well -->
	</div> <!-- end authentication-form div -->
      </div> <!-- end row1, column1 -->

      <br />
      <br />
      <br />
      <br />

      <div class="col-lg-4 col-lg-offset-1">
	<div class="container-fluid" id="authentication-info"
	     style="align-content: left; align: right; text-align: center;">
	  <h1>This is the authentication page.</h1>
	  <p>This page should ask some stuff and do some stuff to let some folks log in.</p>
	</div>
      </div>
    </div> <!-- end row 1 -->
  </div> 
</div>

</body>
</html>
